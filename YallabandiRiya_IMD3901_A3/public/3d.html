<html>

<head>
  <title>Tic Tac Toe</title>
  <meta name="description" content="Multiplayer Tic Tac Toe Game">
  <script src="js/aframe.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>

</head>

<body>
  <a-scene background="color: white" cursor="rayOrigin: mouse">

    <!-- CURSOR -->
    <a-entity progressive-controls>
      <a-entity camera look-controls-enabled="false" wasd-controls-enabled="false" position="0 2.2 4">
        <a-entity cursor="rayOrigin:mouse;" raycaster="far:20; interval:200, objects:.interactive;"
          intersection-spwan="event:click; mixin:vovel"></a-entity>
      </a-entity>
    </a-entity>

    <!-- Button 01 RED-->
    <a-entity id="redBtn" position="-1 5 0"
      animation__click="property:position; from:-1 5.1 0; to:-1 5 0; startEvents:click; dur:300">
      <a-entity geometry="primitive:box; width:0.8; height:0.7;depth: 0.2;" material="color:rgb(255, 0, 0)"
        animation__mouseenter="property:material.color; type:color; to:rgb(255, 100, 100); startEvents:mouseenter; dur:200"
        animation__mouseleave="property:material.color; type:color; to:rgb(255, 0, 0); startEvents:mouseleave; dur:200">
      </a-entity>
      <a-entity text="value:Red; 
        color:White; font:roboto; width:2; anchor:left; baseline:top; wrapCount:10;" position="-0.35 0.1 0.099">
      </a-entity>
    </a-entity>
    <!-- Button 02 BLACK-->
    <a-entity id="blackBtn" position="0 5 0"
      animation__click="property:position; from: 0 5.1 0 ; to: 0 5 0;  startEvents:click; dur:300">
      <a-entity geometry="primitive:box; width:0.8; height:0.7;depth: 0.2;" material="color:rgb(0, 0, 0)"
        animation__mouseenter="property:material.color; type:color; to:rgb(50, 50, 50); startEvents:mouseenter; dur:200"
        animation__mouseleave="property:material.color; type:color; to:rgb(0, 0, 0); startEvents:mouseleave; dur:200">
      </a-entity>
      <a-entity text="value:Black; 
    color:White; font:roboto; width:1.9; anchor:left; baseline:top; wrapCount:12;" position="-0.35 0.1 0.099">
      </a-entity>
    </a-entity>
    <!-- Button 03 GREEN-->
    <a-entity id="greenBtn" position="1 5 0"
      animation__click="property:position; from: 1 5.1 0; to: 1 5 0; startEvents:click; dur:300">
      <a-entity geometry="primitive:box; width:0.8; height:0.7;depth: 0.2;" material="color:rgb(0, 255, 0)"
        animation__mouseenter="property:material.color; type:color; to:rgb(100, 255, 100); startEvents:mouseenter; dur:200"
        animation__mouseleave="property:material.color; type:color; to:rgb(0, 255, 0); startEvents:mouseleave; dur:200">
      </a-entity>
      <a-entity text="value:Green; 
    color:white; font:roboto; width:2; anchor:left; baseline:top; wrapCount:14;" position="-0.35 0.1 0.099"></a-entity>
    </a-entity>

    <a-entity id="textPlayer" text="value:(Player 1); 
    color:black; font:roboto; width:1.8; anchor:left; baseline:top; wrapCount:20;" position="-5.3 4.6 1"></a-entity>
    <a-entity id="textComd" text="value:Player 2 can play now; 
    color:black; font:roboto; width:1.8; anchor:left; baseline:top; wrapCount:20;" position="-5.3 4.35 1"></a-entity>

    <!-- Invisble Buttons -->
    <a-entity id="btn00">
      <a-entity position="-1.8 3.8 0" geometry="primitive:box; width:1.4; height:1.4;depth: 0.2;"
        material="color:white">
        <a-entity id="text00" text="value:; 
        color:black; font:roboto; width:5; anchor:left; baseline:top; wrapCount:8;" position="-0.3 0.2 0.099"></a-entity>
      </a-entity>
    </a-entity>
    <a-entity id="btn01">
      <a-entity position="0 3.8 0" geometry="primitive:box; width:1.4; height:1.4;depth: 0.2;" material="color:white">
        <a-entity id="text01" text="value:; 
        color:black; font:roboto; width:5; anchor:left; baseline:top; wrapCount:8;" position="-0.45 0.2 0.099"></a-entity>
      </a-entity>
    </a-entity>
    <a-entity id="btn02">
      <a-entity position="1.8 3.8 0" geometry="primitive:box; width:1.4; height:1.4;depth: 0.2;" material="color:white">
        <a-entity id="text02" text="value:; 
        color:black; font:roboto; width:5; anchor:left; baseline:top; wrapCount:8;" position="-0.55 0.2 0.099"></a-entity>
      </a-entity>
    </a-entity>

    <a-entity id="btn10">
      <a-entity position="-1.8 2 0" geometry="primitive:box; width:1.4; height:1.4;depth: 0.2;" material="color:white">
        <a-entity id="text10" text="value:; 
        color:black; font:roboto; width:5; anchor:left; baseline:top; wrapCount:8;" position="-0.3 0.3 0.099">
        </a-entity>
      </a-entity>
    </a-entity>
    <a-entity id="btn11">
      <a-entity position="0 2 0" geometry="primitive:box; width:1.4; height:1.4;depth: 0.2;" material="color:white">
        <a-entity id="text11" text="value:; 
        color:black; font:roboto; width:5; anchor:left; baseline:top; wrapCount:8;" position="-0.45 0.3 0.099">
        </a-entity>
      </a-entity>
    </a-entity>
    <a-entity id="btn12">
      <a-entity position="1.8 2 0" geometry="primitive:box; width:1.4; height:1.4;depth: 0.2;" material="color:white">
        <a-entity id="text12" text="value:; 
        color:black; font:roboto; width:5; anchor:left; baseline:top; wrapCount:8;" position="-0.55 0.3 0.099">
        </a-entity>
      </a-entity>
    </a-entity>

    <a-entity id="btn20">
      <a-entity position="-1.8 0.2 0" geometry="primitive:box; width:1.4; height:1.4;depth: 0.2;"
        material="color:white">
        <a-entity id="text20" text="value:; 
        color:black; font:roboto; width:5; anchor:left; baseline:top; wrapCount:8;" position="-0.3 0.45 0.099">
        </a-entity>
      </a-entity>
    </a-entity>
    <a-entity id="btn21">
      <a-entity position="0 0.2 0" geometry="primitive:box; width:1.4; height:1.4;depth: 0.2;" material="color:white">
        <a-entity id="text21" text="value:; 
        color:black; font:roboto; width:5; anchor:left; baseline:top; wrapCount:8;" position="-0.45 0.45 0.099">
        </a-entity>
      </a-entity>
    </a-entity>
    <a-entity id="btn22">
      <a-entity position="1.8 0.2 0" geometry="primitive:box; width:1.4; height:1.4;depth: 0.2;" material="color:white">
        <a-entity id="text22" text="value:; 
        color:black; font:roboto; width:5; anchor:left; baseline:top; wrapCount:8;" position="-0.55 0.45 0.099">
        </a-entity>
      </a-entity>
    </a-entity>

  </a-scene>
  <!-- SCRIPT OF 3D GAME-->
  <script>

    var player = 1;
    var count = 0;
    var board = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];
    var lineColor = "rgb(0,0,0)";

    var socket = io();
    socket.on('connect', (userData) => {


      socket.on('player1', function () {
        player = 1;
      });

      socket.on('player2', function () {
        player = 2;
        socket.emit('getState');
      });

      socket.on('getState', function () {
        socket.emit('state', { color: lineColor, board: board, counter: count });
      });

      socket.on('state', function (value) {
        lineColor = value.color;
        board = value.board;
        count = value.counter;
        drawBoard(lineColor);
      });

      socket.on('changeColor', function (value) {
        lineColor = value;
        console.log(value);
        drawBoard(lineColor);
      });

      socket.on('board', function (value) {
        board = value.board;
        count = value.counter;
        console.log(value);
        console.log(player);
        drawBoard(lineColor);
      });

      socket.on('win', function (value) {
        drawBoard(lineColor);
        if (value == 0) {
          alert("Match is Draw");
        }
        else if (value == player) {
          alert("You Win Game");
        }
        else {
          alert("You Loss Game");
        }
        window.location.href = './index.html';
      });

      document.querySelector('#redBtn').addEventListener('click', () => {
        lineColor = "rgb(255,0,0)";
        socket.emit('changeColor', lineColor);
        drawBoard(lineColor);
      });


      document.querySelector('#blackBtn').addEventListener('click', () => {
        lineColor = "rgb(0,0,0)";
        socket.emit('changeColor', lineColor);
        drawBoard(lineColor);
      });

      document.querySelector('#greenBtn').addEventListener('click', () => {
        lineColor = "rgb(0,255,0)";
        socket.emit('changeColor', lineColor);
        drawBoard(lineColor);
      });

      document.querySelector('#redBtn').addEventListener('click', () => { lineColor = "rgb(255,0,0)"; })
      document.querySelector('#blackBtn').addEventListener('click', () => { lineColor = "rgb(0,0,0)"; })
      document.querySelector('#greenBtn').addEventListener('click', () => { lineColor = "rgb(0,255,0)"; })
      for (let x = 0; x < 3; x++) {
        for (let y = 0; y < 3; y++) {
          document.querySelector('#btn' + x + y).addEventListener('click', () => {
            if (board[x][y] === 0 && count%2 === player - 1){
                board[x][y] = player;
                socket.emit('board', { board: board, counter: count });
          }
        });
        }
      }
    });


    function drawBoard(lineColor) {
      document.querySelector("#textPlayer").setAttribute('text',"value:(Player " + player + " );");
      document.querySelector("#textComd").setAttribute('text',"value:(Player " + (count % 2 + 1) + " can play now... );");
      for (let x = 0; x < 3; x++) {
        for (let y = 0; y < 3; y++) {
          if (board[x][y] == 1) {
            document.querySelector('#text' + x + y).setAttribute('text', "value:X; color: #f1be32");
          }
          else if (board[x][y] == 2) {
            document.querySelector('#text' + x + y).setAttribute('text', "value:O; color: #01bBC2");
          }
        }
      }


      let scene = document.querySelector('a-scene');
      for (let x = -1; x < 2; x += 2) {
        let line = document.createElement('a-entity');
        line.innerHTML = "<a-entity position= '" + x + " 2 0' material = 'color: " + lineColor + "' geometry= 'primitive:box; width:0.2; depth:0.2; height:5;' >";
        scene.appendChild(line);
      }

      for (let y = 1; y < 4; y += 2) {
        let line = document.createElement('a-entity');
        line.innerHTML = "<a-entity position= '0 " + y + " 0' material = 'color: " + lineColor + "' geometry= 'primitive:box; width:5; depth:0.2; height:0.2;' >";
        scene.appendChild(line);
      }

      if (count < 9 && count % 2 === player - 1) {
        checkWhoWin();
      }
      if (count >= 9) {
        socket.emit('win', 0);
      }

    }

    drawBoard(lineColor);


    const onClick = (event) => {
      drawBoard(lineColor);
      console.log(board);
    }
    window.addEventListener('click', onClick);

    function checkWhoWin() {
      //check win
      for (let i = 0; i < 3; i++) {
        if ((board[i][0] === player && board[i][1] === player && board[i][2] === player) || (board[0][i] === player && board[1][i] === player && board[2][i] === player)) {
          socket.emit('win', player);
        }
      }
      if ((board[0][0] === player && board[1][1] === player && board[2][2] === player) || (board[0][2] === player && board[1][1] === player && board[2][0] === player)) {
        socket.emit('win', player);
      }
    }
  </script>
</body>

</html>